
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Love Planet - T·∫°o v≈© tr·ª• 3D, chia s·∫ª c·∫£m x√∫c, g·ª≠i t·∫∑ng m√≥n qu√† √Ω nghƒ©a v·ªõi hi·ªáu ·ª©ng ƒë·∫πp m·∫Øt. Tr·∫£i nghi·ªám kh√¥ng gian thi√™n h√† ƒë·ªôc ƒë√°o, c√° nh√¢n h√≥a v√† b·∫£o m·∫≠t.">
    <meta name="keywords"
        content="Love Planet, thi√™n h√† 3D, v≈© tr·ª•, qu√† t·∫∑ng, hi·ªáu ·ª©ng 3D, chia s·∫ª c·∫£m x√∫c, b·∫£o m·∫≠t code, obfuscate, three.js, t·∫∑ng qu√† online, kh√¥ng gian ·∫£o, tr·∫£i nghi·ªám t∆∞∆°ng t√°c">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Love Planet Team">
    <link rel="canonical" href="https://loveplanet.vercel.app/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://loveplanet.vercel.app/">
    <meta property="og:title" content="Love Planet - V≈© tr·ª• 3D, Qu√† t·∫∑ng c·∫£m x√∫c, Hi·ªáu ·ª©ng ƒë·∫πp m·∫Øt">
    <meta property="og:description"
        content="T·∫°o thi√™n h√† 3D, g·ª≠i qu√† t·∫∑ng √Ω nghƒ©a, chia s·∫ª c·∫£m x√∫c v·ªõi hi·ªáu ·ª©ng t∆∞∆°ng t√°c ƒë·ªôc ƒë√°o. B·∫£o m·∫≠t code, tr·∫£i nghi·ªám c√° nh√¢n h√≥a.">
    <meta property="og:image" content="https://loveplanet.vercel.app/assets/images/planet.png">

    <div id="google_translate_element" style="position:fixed;top:70px;right:13px;z-index:10000;"></div>
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.174.0/build/three.module.js",
        "three/addons/controls/OrbitControls.js": "https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js",
        "three/addons/loaders/FontLoader.js": "https://unpkg.com/three@0.152.2/examples/jsm/loaders/FontLoader.js",
        "three/addons/geometries/TextGeometry.js": "https://unpkg.com/three@0.152.2/examples/jsm/geometries/TextGeometry.js",
        "three/addons/utils/BufferGeometryUtils.js": "https://unpkg.com/three@0.152.2/examples/jsm/utils/BufferGeometryUtils.js",
        "three/addons/loaders/GLTFLoader.js": "https://unpkg.com/three@0.152.2/examples/jsm/loaders/GLTFLoader.js",
        "three/addons/postprocessing/EffectComposer.js": "https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/EffectComposer.js",
        "three/addons/postprocessing/RenderPass.js": "https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/RenderPass.js",
        "three/addons/postprocessing/UnrealBloomPass.js": "https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/UnrealBloomPass.js"
      }
    }
    </script>
    <script type="module" src="./js/heartText.js"></script>
    <script type="module" src="./js/nebula-system.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Planet</title>
    <link rel="icon" type="image/x-icon" href="assets/images/planet.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">

    <style>
        body {
            margin: 0;
            background: #000000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        canvas {
            display: block;
            width: 100vw !important;
            height: 100vh !important;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .stars-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 1px, transparent 1px);
            background-size: 10px 10px;
            z-index: 0;
            animation: twinkle 4s infinite;
        }

        @keyframes twinkle {
            0% {
                opacity: 0.5;
            }

            50% {
                opacity: 0.9;
            }

            100% {
                opacity: 0.5;
            }
        }

        .info {
            position: absolute;
            top: 70px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            z-index: 3;
        }

        .hidden {
            display: none !important;
        }

        /* Spinner cho n√∫t */
        .spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #fff;
            border-top: 2px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        /* Fade in effect cho popup */
        .share-popup {
            animation: fadeIn 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: opacity, transform;
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Hi·ªáu ·ª©ng tan bi·∫øn d·∫°ng h·∫°t khi ƒë√≥ng popup */
        .share-popup.fade-out {
            animation: particleDisintegrate 1.8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
            filter: blur(0px);
        }

        @keyframes particleDisintegrate {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
                filter: blur(0px) brightness(1);
            }

            20% {
                opacity: 0.95;
                transform: translate(-50%, -50%) scale(1.02);
                filter: blur(0.5px) brightness(1.1);
            }

            40% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.05);
                filter: blur(1px) brightness(1.2);
            }

            70% {
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(0.8);
                filter: blur(4px) brightness(0.8);
            }

            90% {
                opacity: 0.1;
                transform: translate(-50%, -50%) scale(0.3);
                filter: blur(8px) brightness(0.5);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
                filter: blur(12px) brightness(0);
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
            }
        }

        /* CSS cho h·∫°t tr√≤n nh·ªè */
        .particle {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            transition: all 2.5s cubic-bezier(0.165, 0.84, 0.44, 1);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
        }

        /* Animation cho h·∫°t tan bi·∫øn */
        @keyframes particleFadeOut {
            0% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
                filter: blur(0px);
            }

            25% {
                opacity: 0.9;
                transform: scale(0.95) rotate(90deg) translate(calc(var(--dx) * 0.2), calc(var(--dy) * 0.2));
                filter: blur(0.5px);
            }

            60% {
                opacity: 0.5;
                transform: scale(0.6) rotate(240deg) translate(calc(var(--dx) * 0.7), calc(var(--dy) * 0.7));
                filter: blur(2px);
            }

            85% {
                opacity: 0.2;
                transform: scale(0.2) rotate(320deg) translate(calc(var(--dx) * 0.9), calc(var(--dy) * 0.9));
                filter: blur(4px);
            }

            100% {
                opacity: 0;
                transform: scale(0) rotate(360deg) translate(var(--dx), var(--dy));
                filter: blur(6px);
            }
        }

        /* ·∫®n ph·∫ßn ch·ªØ 'Ch·ªçn ng√¥n ng·ªØ' nh∆∞ng gi·ªØ dropdown */
        .goog-te-gadget .goog-te-menu-value {
            display: none !important;
        }

        .goog-te-gadget .goog-te-combo {
            margin-left: 0 !important;
        }

        /* ·∫®n icon Google m·∫∑c ƒë·ªãnh */
        .goog-logo-link,
        .goog-te-gadget-icon {
            display: none !important;
        }

        body {
            top: 0px !important;
            position: static !important;
        }

        /* ƒê·ªãnh v·ªã icon custom ƒë√∫ng v·ªã tr√≠ icon Google */
        .goog-te-gadget {
            position: relative !important;
            display: inline-block !important;
        }

        .custom-translate-icon {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            object-fit: contain;
            cursor: pointer;
            z-index: 10001;
        }
    </style>

    <script src="js/exif.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script>
        function showErrorToast(msg) {
            let toast = document.createElement('div');
            toast.style.position = 'fixed';
            toast.style.bottom = '24px';
            toast.style.right = '24px';
            toast.style.background = 'rgba(40,40,40,0.95)';
            toast.style.color = '#fff';
            toast.style.padding = '14px 22px';
            toast.style.borderRadius = '8px';
            toast.style.fontSize = '15px';
            toast.style.boxShadow = '0 2px 12px rgba(0,0,0,0.18)';
            toast.style.zIndex = 9999;
            toast.style.maxWidth = '350px';
            toast.style.cursor = 'pointer';
            toast.innerHTML = '<b>L·ªói ·ª©ng d·ª•ng:</b><br>' + msg + '<br><span style="font-size:12px;opacity:0.7;">(Click ƒë·ªÉ ·∫©n)</span>';
            toast.onclick = () => toast.remove();
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 10000);
        }
        window.addEventListener('error', function (e) {
            showErrorToast(e.message + '<br>' + e.filename + ':' + e.lineno);
        });
        window.addEventListener('unhandledrejection', function (e) {
            showErrorToast('Promise l·ªói: ' + e.reason);
        });
    </script>

    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'vi',
                includedLanguages: 'vi,en,id,my,tl,ko,ja,es,km',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script>
        // Ch√®n icon custom v√†o trong widget Google Translate sau khi widget render
        function insertCustomTranslateIcon() {
            var gadget = document.querySelector('.goog-te-gadget');
            if (gadget && !document.querySelector('.custom-translate-icon')) {
                var img = document.createElement('img');
                img.src = 'assets/images/translator.gif';
                img.alt = 'Language';
                img.className = 'custom-translate-icon';
                img.style.position = 'absolute';
                img.style.right = '0';
                img.style.top = '50%';
                img.style.transform = 'translateY(-50%)';
                img.style.width = '20px';
                img.style.height = '20px';
                img.style.objectFit = 'contain';
                img.style.cursor = 'pointer';
                img.style.zIndex = '10001';
                gadget.appendChild(img);
            }
        }
        // ƒê·ª£i widget Google Translate render xong m·ªõi ch√®n icon
        document.addEventListener('DOMContentLoaded', function () {
            var interval = setInterval(function () {
                var gadget = document.querySelector('.goog-te-gadget');
                if (gadget) {
                    insertCustomTranslateIcon();
                    clearInterval(interval);
                }
            }, 300);
        });
    </script>

</head>

<body>
    <canvas id="canvas"
        style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:10;pointer-events:none;"></canvas>
    <div class="stars-bg"></div>

    <!-- Th√™m b·∫£ng h∆∞·ªõng d·∫´n -->
    <div class="help-panel">
        <div class="controls-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3 class="help-title" style="margin: 0;">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h3>
            <div style="display: flex; gap: 10px; align-items: center;">
                <a href="https://www.tiktok.com/@tvq1504" target="_blank"
                    style="text-decoration: none; color: inherit;">
                    <div
                        style="display: flex; align-items: center; gap: 5px; padding: 6px 8px; background: rgba(255,255,255,0.1); border-radius: 6px; transition: all 0.3s ease; cursor: pointer; font-size: 0.8em;">
                        <i class="fab fa-tiktok" style="font-size: 14px; color: #ff0050;"></i>
                        <span>TikTok</span>
                    </div>
                </a>
                <a href="https://zalo.me/0363232681" target="_blank"
                    style="text-decoration: none; color: inherit; margin-right: 35px;">
                    <div
                        style="display: flex; align-items: center; gap: 5px; padding: 6px 8px; background: rgba(255,255,255,0.1); border-radius: 6px; transition: all 0.3s ease; cursor: pointer; font-size: 0.8em;">
                        <i class="fab fa-facebook-messenger" style="font-size: 14px; color: #0068ff;"></i>
                        <span>Zalo</span>
                    </div>
                </a>
                <button class="close-btn"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div
            style="font-size: 0.85em; color: rgba(255,255,255,0.7); margin-top: 8px; margin-bottom: 2px; font-style: italic;">
            N·∫øu g·∫∑p l·ªói, vui l√≤ng li√™n h·ªá TikTok ho·∫∑c Zalo (icon g√≥c ph·∫£i)
        </div>
        <div class="help-section">
            <div class="section-divider">
                <h4>ƒêi·ªÅu khi·ªÉn c∆° b·∫£n</h4>
            </div>
            <ul>
                <li><span class="label-pc">[PC]</span> Click ƒë√∫p chu·ªôt: Ph√°t nh·∫°c v√† k√≠ch ho·∫°t hi·ªáu ·ª©ng camera</li>
                <li><span class="label-pc">[PC]</span> <span
                        style="font-size:1.2em;vertical-align:middle;">&#8593;</span> ·∫§n ph√≠m m≈©i t√™n l√™n: B·∫≠t/T·∫Øt hi·ªáu
                    ·ª©ng bay c·ªßa v√≤ng ·∫£nh
                </li>
                <li><span class="label-pc">[PC]</span> ·∫§n v√†o icon b·ª©c th∆∞: Hi·ªÉn th·ªã/·∫®n ch·ªØ 3D
                </li>
                <li><span class="label-mobile">[Mobile]</span>·∫§n 2 l·∫ßn v√†o m√†n h√¨nh: Ph√°t nh·∫°c v√† k√≠ch ho·∫°t hi·ªáu ·ª©ng
                    camera</li>
                <li><span class="label-mobile">[Mobile]</span> ·∫§n v√†o icon h·ªôp qu√†: B·∫≠t/T·∫Øt hi·ªáu ·ª©ng bay c·ªßa v√≤ng ·∫£nh
                </li>
                <li><span class="label-mobile">[Mobile]</span> ·∫§n v√†o icon b·ª©c th∆∞: Hi·ªÉn th·ªã/·∫®n ch·ªØ 3D
                </li>
            </ul>
        </div>

        <div class="help-section">
            <div class="section-divider">
                <h4>ƒêi·ªÅu ch·ªânh g√≥c nh√¨n</h4>
            </div>
            <ul>
                <li>Click v√† k√©o: Xoay camera</li>
                <li>Cu·ªôn chu·ªôt: Ph√≥ng to/thu nh·ªè</li>
                <li>Mobile: Vu·ªët ƒë·ªÉ xoay, ch·ª•m/t√°ch ƒë·ªÉ ph√≥ng to/thu nh·ªè</li>
            </ul>
        </div>

        <div class="help-section">
            <div class="section-divider">
                <h4>T√πy ch·ªânh <<ƒê·ªëi v·ªõi ng∆∞·ªùi t·∫°o>></h4>
            </div>
            <p>Nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng C√ÄI ƒê·∫∂T ·ªü g√≥c ph·∫£i ƒë·ªÉ:</p>
            <ul>
                <li>Thay ƒë·ªïi m√†u s·∫Øc (h·∫°t, tinh c·∫ßu) v√† giao di·ªán</li>
                <li>ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô xoay,t·ªëc ƒë·ªô bay c·ªßa ·∫£nh v√† h·∫°t</li>
                <li>Ch·ªçn ch·∫ø ƒë·ªô m√†u t·ª± ƒë·ªông ho·∫∑c t√πy ch·ªânh</li>
                <li>Thay ƒë·ªïi ·∫£nh v√† √¢m thanh</li>
            </ul>
        </div>


    </div>

    <!-- N√∫t ƒëƒÉng nh·∫≠p Google (icon tr√≤n) ·ªü g√≥c tr√™n tr√°i -->
    <button class="google-login-btn" id="googleLoginBtn" title="ƒêƒÉng nh·∫≠p Google">
        <i class="fab fa-google"></i>
    </button>

    <!-- Logo user sau khi ƒëƒÉng nh·∫≠p (dropdown trigger) -->
    <div id="userLogoContainer" style="display:none;position:fixed;top:20px;left:20px;z-index:1002;">
        <img id="userLogo" src="" alt="avatar"
            style="width:40px;height:40px;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,0.15);"
            title="Click ƒë·ªÉ xem th√¥ng tin">
    </div>

    <!-- Dropdown th√¥ng tin user -->
    <div id="userDropdown"
        style="display:none;position:fixed;top:70px;left:20px;z-index:1003;background:rgba(255,255,255,0.95);border-radius:12px;padding:16px;box-shadow:0 4px 20px rgba(0,0,0,0.15);min-width:200px;backdrop-filter:blur(10px);">
        <div
            style="display:flex;align-items:center;gap:12px;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid #eee;">
            <img id="userAvatar" src="" alt="avatar" style="width:40px;height:40px;border-radius:50%;">
            <div>
                <div id="userName" style="font-weight:600;color:#333;font-size:14px;"></div>
                <div id="userEmail" style="font-size:12px;color:#666;"></div>
            </div>
        </div>
        <button id="logoutBtn"
            style="width:100%;background:#ff6b6b;color:#fff;border:none;border-radius:8px;padding:8px 12px;font-size:13px;font-weight:500;cursor:pointer;transition:background 0.2s;">ƒêƒÉng
            xu·∫•t</button>
    </div>

    <!-- Icon h∆∞·ªõng d·∫´n l√πi xu·ªëng d∆∞·ªõi -->
    <div class="help-icon">
        <i class="fas fa-question-circle"></i>
    </div>

    <!-- B·∫£ng h∆∞·ªõng d·∫´n nhanh cho Mobile -->
    <div class="quick-help-panel mobile-help" id="mobileQuickHelp">
        <div class="quick-help-header">
            <h3>üì± H∆∞·ªõng d·∫´n Mobile</h3>
            <button class="quick-help-close-btn" onclick="closeQuickHelp('mobile')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="quick-help-content">
            <div class="quick-help-section">
                <h4>üì∑ Hi·ªáu ·ª©ng Camera</h4>
                <p>·∫§n 2 l·∫ßn v√†o m√†n h√¨nh ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng camera</p>
            </div>
            <div class="quick-help-section">
                <h4>üå∏ Hi·ªáu ·ª©ng bay v√≤ng ·∫£nh</h4>
                <p>·∫§n v√†o "icon h·ªôp qu√†" ·ªü g√≥c ph·∫£i m√†n h√¨nh ƒë·ªÉ b·∫≠t/t·∫Øt hi·ªáu ·ª©ng bay</p>
            </div>
            <div class="quick-help-section">
                <h4>üíå Th∆∞ m·∫≠t 3D</h4>
                <p>·∫§n v√†o "icon b·ª©c th∆∞" ƒë·ªÉ hi·ªÉn th·ªã/·∫©n ch·ªØ 3D (N·∫øu c√≥)</p>
            </div>
            <div class="quick-help-section">
                <h4>‚òÑÔ∏è M∆∞a sao bƒÉng</h4>
                <p>T·ª± ƒë·ªông b·∫≠t khi thi√™n h√† c√≥ t√≠nh nƒÉng n√†y</p>
            </div>
            <div class="quick-help-section">
                <h4>üéÆ ƒêi·ªÅu khi·ªÉn camera</h4>
                <p>Vu·ªët ƒë·ªÉ xoay, ch·ª•m/t√°ch ƒë·ªÉ ph√≥ng to/thu nh·ªè</p>
            </div>
        </div>
    </div>

    <!-- B·∫£ng h∆∞·ªõng d·∫´n nhanh cho Desktop -->
    <div class="quick-help-panel desktop-help" id="desktopQuickHelp">
        <div class="quick-help-header">
            <h3>üíª H∆∞·ªõng d·∫´n Desktop</h3>
            <button class="quick-help-close-btn" onclick="closeQuickHelp('desktop')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="quick-help-content">
            <div class="quick-help-section">
                <h4>üì∑ Hi·ªáu ·ª©ng Camera</h4>
                <p>Click ƒë√∫p chu·ªôt ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng camera</p>
            </div>
            <div class="quick-help-section">
                <h4>üå∏ Hi·ªáu ·ª©ng bay v√≤ng ·∫£nh</h4>
                <p><span style="font-size:1.2em;vertical-align:middle;">&#8593;</span> ·∫§n ph√≠m m≈©i t√™n l√™n ƒë·ªÉ b·∫≠t/t·∫Øt
                    hi·ªáu ·ª©ng bay</p>
            </div>
            <div class="quick-help-section">
                <h4>üíå Th∆∞ m·∫≠t 3D</h4>
                <p>·∫§n v√†o "icon b·ª©c th∆∞" ƒë·ªÉ hi·ªÉn th·ªã/·∫©n ch·ªØ 3D(N·∫øu c√≥)</p>
            </div>
            <div class="quick-help-section">
                <h4>‚òÑÔ∏è M∆∞a sao bƒÉng</h4>
                <p>T·ª± ƒë·ªông b·∫≠t khi thi√™n h√† c√≥ t√≠nh nƒÉng n√†y</p>
            </div>
            <div class="quick-help-section">
                <h4>üéÆ ƒêi·ªÅu khi·ªÉn camera</h4>
                <p>Click v√† k√©o ƒë·ªÉ xoay, cu·ªôn chu·ªôt ƒë·ªÉ ph√≥ng to/thu nh·ªè</p>
            </div>
        </div>
    </div>

    <!-- N√∫t M√≥n qu√† nh·ªè ·ªü ch√≠nh gi·ªØa tr√™n c√πng m√†n h√¨nh -->
    <button id="gift-btn" class="gift-btn" title="Hi·ªáu ·ª©ng bay v√≤ng ·∫£nh">
        <img src="assets/images/gift.gif" alt="Gift" style="width: 28px; height: 28px; vertical-align: middle;">
    </button>

    <!-- N√∫t Letter nh·ªè ·ªü ch√≠nh gi·ªØa tr√™n c√πng m√†n h√¨nh (ch·ªâ hi·ªÉn th·ªã ·ªü web con) -->
    <button id="letter-btn" class="letter-btn" title="Hi·ªáu ·ª©ng th∆∞ t√¨nh">
        <img src="assets/images/letter.gif" alt="Letter" style="width: 28px; height: 28px; vertical-align: middle;">
    </button>
    <script>
        function isMobileDevice() {
            // Ki·ªÉm tra user agent cho mobile v√† tablet
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobile = /mobi|android|iphone|ipad|ipod|windows phone|webos|blackberry/i.test(userAgent);

            // Ki·ªÉm tra th√™m cho iPad Pro v√† iPad m·ªõi
            const isIPad = /ipad/i.test(userAgent) ||
                (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

            // Ki·ªÉm tra Surface v√† tablet Windows
            const isSurface = navigator.platform === 'Win32' && navigator.maxTouchPoints > 1;

            // Ki·ªÉm tra screen width cho tablet
            const isTablet = window.innerWidth >= 768 && window.innerWidth <= 1024;

            return isMobile || isIPad || isSurface || isTablet;
        }
        function updateGiftBtnVisibility() {
            var giftBtn = document.getElementById('gift-btn');
            var letterBtn = document.getElementById('letter-btn');
            if (!giftBtn) return;

            // Ki·ªÉm tra n·∫øu l√† mobile device
            var isMobileOrTablet = isMobileDevice();

            // Ki·ªÉm tra tablet landscape l·ªõn (1024px-1380px landscape)
            var isTabletLandscape = window.innerWidth > 1024 &&
                window.innerWidth <= 1380 &&
                window.innerHeight < window.innerWidth;

            // Ki·ªÉm tra Surface v√† tablet Windows
            var isSurface = navigator.platform === 'Win32' && navigator.maxTouchPoints > 1;

            // ·∫®n tr√™n desktop (>1025px portrait ho·∫∑c >1380px landscape) nh∆∞ng kh√¥ng ph·∫£i Surface
            if (((window.innerWidth > 1025 && window.innerHeight > window.innerWidth) ||
                (window.innerWidth > 1380 && window.innerHeight < window.innerWidth)) && !isSurface) {
                giftBtn.style.display = 'none';
            } else if (isMobileOrTablet || isTabletLandscape || isSurface) {
                giftBtn.style.display = 'block';
            } else {
                giftBtn.style.display = 'none';
            }

            // Letter button ch·ªâ hi·ªÉn th·ªã ·ªü web con
            if (letterBtn) {
                const hash = window.location.hash;
                if (hash.startsWith('#config=') || hash.startsWith('#id=')) {
                    // Web con - hi·ªÉn th·ªã theo c√πng logic v·ªõi gift-btn
                    if (((window.innerWidth > 1025 && window.innerHeight > window.innerWidth) ||
                        (window.innerWidth > 1380 && window.innerHeight < window.innerWidth)) && !isSurface) {
                        letterBtn.style.display = 'none';
                    } else if (isMobileOrTablet || isTabletLandscape || isSurface) {
                        letterBtn.style.display = 'block';
                    } else {
                        letterBtn.style.display = 'none';
                    }
                } else {
                    // Web cha - ·∫©n ho√†n to√†n
                    letterBtn.style.display = 'none';
                }
            }
        }

        // Th√™m class v√†o body ngay l·∫≠p t·ª©c
        (function () {
            const hash = window.location.hash;
            if (hash.startsWith('#config=') || hash.startsWith('#id=')) {
                document.body.classList.add('web-con');
            } else {
                document.body.classList.add('web-cha');
            }
        })();

        document.addEventListener('DOMContentLoaded', updateGiftBtnVisibility);
        window.addEventListener('resize', updateGiftBtnVisibility);
        window.addEventListener('orientationchange', updateGiftBtnVisibility);
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { FontLoader } from 'three/addons/loaders/FontLoader.js';
        import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';
        import { AudioManager } from './js/audio.js';
        import { ParticleSystem } from './js/particles.js';
        import { CentralSphere } from './js/sphere.js';
        import { FlowerRingSystem } from './js/imageRing.js';
        import { CameraController } from './js/camera.js';
        import { Heart } from './js/modelGlb.js';
        import { processPayment, createPaymentModal, showToast, initWebSocket } from './js/payment.js';
        import { EffectComposer } from 'https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/EffectComposer.js';
        import { RenderPass } from 'https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'https://unpkg.com/three@0.152.2/examples/jsm/postprocessing/UnrealBloomPass.js';

        // X·ª≠ l√Ω s·ª± ki·ªán cho b·∫£ng h∆∞·ªõng d·∫´n
        const helpIcon = document.querySelector('.help-icon');
        const helpPanel = document.querySelector('.help-panel');
        const helpCloseBtn = helpPanel.querySelector('.close-btn');

        helpIcon.addEventListener('click', () => {
            // M·ªü b·∫±ng icon - c≈©ng hi·ªÉn th·ªã ·ªü gi·ªØa m√†n h√¨nh
            helpPanel.classList.add('center');
            helpPanel.classList.add('active');
        });

        helpCloseBtn.addEventListener('click', () => {
            helpPanel.classList.remove('active', 'center');
        });

        // ƒê√≥ng b·∫£ng h∆∞·ªõng d·∫´n khi click ngo√†i
        document.addEventListener('click', (e) => {
            if (helpPanel.classList.contains('active') &&
                !helpPanel.contains(e.target) &&
                !helpIcon.contains(e.target)) {
                helpPanel.classList.remove('active', 'center');
            }
        });

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000);
        renderer.setPixelRatio(window.devicePixelRatio);
        // Gi·ªõi h·∫°n pixel ratio ƒë·ªÉ gi·∫£m t·∫£i GPU tr√™n desktop
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // === BLOOM SETUP ===
        // Ch·ªâ bloom cho ch·ªØ 3D (layer 1)
        const BLOOM_LAYER = 1;
        const bloomParams = {
            exposure: 1,
            bloomStrength: 1.5,
            bloomThreshold: 0,
            bloomRadius: 0.25
        };
        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(
            new THREE.Vector2(window.innerWidth, window.innerHeight),
            bloomParams.bloomStrength,
            bloomParams.bloomRadius,
            bloomParams.bloomThreshold
        );
        const composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        // Handle window resize cho c·∫£ composer
        window.addEventListener('resize', () => {
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
            cameraController.handleResize();
        });

        // Initialize HeartText
        import { HeartText } from './js/heartText.js';
        const heartText = new HeartText(scene);
        // Set initial effect
        heartText.setEffect('none');
        window.renderer = renderer;

        // Add ambient light
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        // Add point lights
        const light1 = new THREE.PointLight(0xffffff, 1, 500);
        light1.position.set(100, 100, 100);
        scene.add(light1);

        const light2 = new THREE.PointLight(0xffffff, 0.5, 500);
        light2.position.set(-100, -100, -100);
        scene.add(light2);

        // Kh·ªüi t·∫°o AudioManager duy nh·∫•t
        if (!window.audioManager) {
            window.audioManager = new AudioManager();
        }

        // Initialize systems
        const audioManager = window.audioManager;
        const particleSystem = new ParticleSystem(scene);
        window.particleSystem = particleSystem;
        const centralSphere = new CentralSphere(scene);
        window.centralSphere = centralSphere;
        centralSphere.setParticleSystem(particleSystem);
        const flowerRingSystem = new FlowerRingSystem(scene);
        centralSphere.setFlowerRing(flowerRingSystem);
        const cameraController = new CameraController(camera, renderer);
        window.cameraController = cameraController;
        const heart = new Heart(scene);

        // ·∫®n loading overlay sau khi t·∫•t c·∫£ ƒë√£ kh·ªüi t·∫°o xong
        setTimeout(() => {
            const loadingOverlay = document.getElementById('flower-loading-overlay');
            if (loadingOverlay) {
                // Auto-hide cho web cha ngay sau 3s
                const hash = window.location.hash;
                const isChildWeb = hash.startsWith('#config=') || hash.startsWith('#id=');
                if (!isChildWeb) {
                    loadingOverlay.style.opacity = '0';
                    loadingOverlay.style.transition = 'opacity 0.8s ease-out';
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                    }, 800);
                } else {
                    // Fallback cho web con: n·∫øu v·∫´n c√≤n hi·ªÉn th·ªã sau 6s th√¨ √©p ·∫©n ƒë·ªÉ tr√°nh treo m√†n h√¨nh
                    setTimeout(() => {
                        if (loadingOverlay && loadingOverlay.style.display !== 'none') {
                            loadingOverlay.style.opacity = '0';
                            loadingOverlay.style.transition = 'opacity 0.8s ease-out';
                            setTimeout(() => {
                                loadingOverlay.style.display = 'none';
                            }, 800);
                        }
                    }, 3000);
                }
            }
        }, 3000); // ƒê·ª£i 3 gi√¢y; web con c√≥ fallback th√™m 3 gi√¢y n·ªØa

        // Double-click handler for desktop
        window.addEventListener('dblclick', (event) => {
            event.preventDefault();
            audioManager.playOnly();
            cameraController.triggerAnimation();
        });

        // Double tap handler for mobile
        let lastTap = 0;
        let tapCount = 0;
        let tapTimer = null;
        let lastTapX = 0;
        let lastTapY = 0;
        let isZooming = false;

        const handleDoubleTap = (event) => {
            // Ki·ªÉm tra n·∫øu ƒëang zoom th√¨ b·ªè qua
            if (isZooming) {
                return;
            }

            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;

            // L·∫•y t·ªça ƒë·ªô t·ª´ changedTouches (cho touchend) ho·∫∑c touches (cho touchstart)
            let currentX, currentY;
            if (event.changedTouches && event.changedTouches.length > 0) {
                currentX = event.changedTouches[0].clientX;
                currentY = event.changedTouches[0].clientY;
            } else if (event.touches && event.touches.length > 0) {
                currentX = event.touches[0].clientX;
                currentY = event.touches[0].clientY;
            } else {
                currentX = event.clientX || 0;
                currentY = event.clientY || 0;
            }

            // T√≠nh kho·∫£ng c√°ch gi·ªØa 2 tap
            const distance = Math.sqrt(
                Math.pow(currentX - lastTapX, 2) +
                Math.pow(currentY - lastTapY, 2)
            );

            // Double tap detected: th·ªùi gian < 600ms, kho·∫£ng c√°ch < 30px, v√† kh√¥ng ph·∫£i zoom
            if (tapLength < 600 && tapLength > 100 && distance < 30) {
                event.preventDefault();
                event.stopPropagation();

                // Clear any pending single tap
                if (tapTimer) {
                    clearTimeout(tapTimer);
                    tapTimer = null;
                }

                // Trigger the same actions as double click
                audioManager.playOnly();
                cameraController.triggerAnimation();

                // Reset tap count
                tapCount = 0;
            } else {
                // Single tap - wait to see if it becomes a double tap
                tapCount++;
                if (tapCount === 1) {
                    tapTimer = setTimeout(() => {
                        // Single tap confirmed
                        tapCount = 0;
                    }, 600);
                }
            }

            lastTap = currentTime;
            lastTapX = currentX;
            lastTapY = currentY;
        };

        // Detect zoom gesture
        let initialDistance = 0;
        const handleTouchStart = (event) => {
            if (event.touches.length === 2) {
                initialDistance = Math.sqrt(
                    Math.pow(event.touches[0].clientX - event.touches[1].clientX, 2) +
                    Math.pow(event.touches[0].clientY - event.touches[1].clientY, 2)
                );
                isZooming = true;
            }
        };

        const handleTouchEnd = () => {
            // Reset zoom state after a delay
            setTimeout(() => {
                isZooming = false;
            }, 300);
        };

        // Add double tap listener for mobile (ch·ªâ d√πng document)
        const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
        if (isMobile) {
            document.addEventListener('touchend', handleDoubleTap);
            document.addEventListener('touchstart', handleTouchStart);
            document.addEventListener('touchend', handleTouchEnd);
        }

        // Th√™m x·ª≠ l√Ω ph√≠m t·∫Øt (ph√≠m Space)
        window.addEventListener('keydown', (event) => {
            if (event.code === 'ArrowUp') {
                event.preventDefault();
                if (flowerRingSystem) {
                    if (!flowerRingSystem.isFlying) {
                        flowerRingSystem.triggerFlyingEffect();
                        showFlowerToast('L·∫°c ·∫£nh thi√™n h√† ƒë∆∞·ª£c k√≠ch ho·∫°t');
                    } else {
                        flowerRingSystem.toggleFlyingPause();
                        if (flowerRingSystem.isPaused) {
                            showFlowerToast('D·ª´ng hi·ªáu ·ª©ng l·∫°c ·∫£nh');
                        } else {
                            showFlowerToast('L·∫°c ·∫£nh thi√™n h√† ƒë∆∞·ª£c k√≠ch ho·∫°t');
                        }
                    }
                }
            }
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            particleSystem.animate();
            centralSphere.animate();
            flowerRingSystem.animate();
            cameraController.update();
            heartText.animate(); // Animate the HeartText
            heart.animate();

            // === BLOOM RENDERING ===
            // 1. Render bloom layer (ch·ªâ ch·ªØ 3D)
            camera.layers.set(BLOOM_LAYER);
            composer.render();

            // 2. Render scene th∆∞·ªùng (kh√¥ng bloom)
            camera.layers.set(0);
            renderer.render(scene, camera);

        }

        animate();

        // Trong <script type="module">, sau khi kh·ªüi t·∫°o flowerRingSystem
        const giftBtn = document.getElementById('gift-btn');
        if (giftBtn) {
            giftBtn.addEventListener('click', () => {
                if (flowerRingSystem) {
                    if (!flowerRingSystem.isFlying) {
                        flowerRingSystem.triggerFlyingEffect();
                        showFlowerToast('L·∫°c ·∫£nh thi√™n h√† ƒë∆∞·ª£c k√≠ch ho·∫°t');
                    } else {
                        flowerRingSystem.toggleFlyingPause();
                        if (flowerRingSystem.isPaused) {
                            showFlowerToast('D·ª´ng hi·ªáu ·ª©ng l·∫°c ·∫£nh');
                        } else {
                            showFlowerToast('L·∫°c ·∫£nh thi√™n h√† ƒë∆∞·ª£c k√≠ch ho·∫°t');
                        }
                    }
                }
                // Kh√¥ng ·∫©n giftBtn ƒë·ªÉ c√≥ th·ªÉ ·∫•n l·∫ßn n·ªØa
            });
        }

        // Logic cho letter-btn - toggle ·∫©n hi·ªán text 3D
        const letterBtn = document.getElementById('letter-btn');
        if (letterBtn) {
            letterBtn.addEventListener('click', () => {
                if (window.heartText) {
                    // Ki·ªÉm tra text c√≥ ƒëang hi·ªÉn th·ªã hay kh√¥ng
                    const isVisible = window.heartText.isHidden ? false : true;

                    if (!isVisible) {
                        // Hi·ªÉn th·ªã text v·ªõi hi·ªáu ·ª©ng xu·∫•t hi·ªán
                        if (typeof window.heartText.show === 'function') {
                            window.heartText.show();
                        }

                        // L·∫•y text hi·ªán t·∫°i t·ª´ config
                        const currentText = window.heartText.config.text;
                        // L·∫•y hi·ªáu ·ª©ng xu·∫•t hi·ªán hi·ªán t·∫°i t·ª´ config
                        const appearEffect = window.heartText.config.appearEffect || 'none';

                        if (
                            appearEffect === 'fadein' &&
                            typeof window.heartText.showFadeInEffect === 'function'
                        ) {
                            window.heartText.showFadeInEffect(currentText, 3500);
                        } else {
                            // N·∫øu kh√¥ng ch·ªçn hi·ªáu ·ª©ng xu·∫•t hi·ªán, ch·ªâ show text b√¨nh th∆∞·ªùng
                            if (typeof window.heartText.setText === 'function') {
                                window.heartText.setText(currentText);
                            }
                        }

                        // Zoom out camera ƒë·ªÉ nh√¨n th·∫•y text r√µ h∆°n
                        if (window.cameraController) {
                            // Ki·ªÉm tra tr·∫°ng th√°i tr√°i tim ƒë·ªÉ ƒëi·ªÅu ch·ªânh v·ªã tr√≠ camera
                            const heartEnabled = document.getElementById('enableCentralHeart')?.checked ||
                                (window.heart3D && window.heart3D.visible);

                            // V·ªã tr√≠ z kh√°c nhau d·ª±a tr√™n tr·∫°ng th√°i tr√°i tim
                            const zPosition = heartEnabled ? 640 : 430;

                            gsap.to(window.cameraController.camera.position, {
                                x: 0,
                                y: 12,
                                z: zPosition,
                                duration: 3,
                                ease: 'power2.out',
                                onUpdate: () => {
                                    window.cameraController.camera.lookAt(0, 20, 0);
                                }
                            });
                        }

                        showLetterToast('Hi·ªÉn th·ªã th∆∞ m·∫≠t');
                    } else {
                        // ·∫®n text ƒëi
                        if (typeof window.heartText.hide === 'function') {
                            window.heartText.hide();
                        }
                        showLetterToast('·∫®n th∆∞ m·∫≠t');
                    }
                }
            });
        }

        // Toast nh·ªè th√¥ng b√°o hi·ªáu ·ª©ng bay ·∫£nh
        function showFlowerToast(message) {
            let toast = document.getElementById('flower-toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'flower-toast';
                document.body.appendChild(toast);
            }
            // Reset style ƒë·ªÉ ƒë·∫£m b·∫£o m√†u m·ªõi
            toast.style.position = 'fixed';
            toast.style.bottom = '32px';
            toast.style.left = '50%';
            toast.style.right = '';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = 'rgba(255,107,107,0.92)';
            toast.style.color = '#fff';
            toast.style.fontSize = '13px';
            toast.style.padding = '7px 18px';
            toast.style.borderRadius = '16px';
            toast.style.boxShadow = '0 2px 8px rgba(255,107,107,0.3)';
            toast.style.zIndex = 9999;
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.2s';

            toast.textContent = message;
            toast.style.opacity = '1';
            // ·∫®n sau 1.5s
            clearTimeout(toast._hideTimeout);
            toast._hideTimeout = setTimeout(() => {
                toast.style.opacity = '0';
            }, 1500);
        }

        // Toast nh·ªè th√¥ng b√°o th∆∞ t√¨nh
        function showLetterToast(message) {
            let toast = document.getElementById('letter-toast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'letter-toast';
                toast.style.position = 'fixed';
                toast.style.bottom = '32px';
                toast.style.left = '50%';
                toast.style.right = '';
                toast.style.transform = 'translateX(-50%)';
                toast.style.background = 'rgba(255,107,107,0.92)';
                toast.style.color = '#fff';
                toast.style.fontSize = '13px';
                toast.style.padding = '7px 18px';
                toast.style.borderRadius = '16px';
                toast.style.boxShadow = '0 2px 8px rgba(255,107,107,0.3)';
                toast.style.zIndex = 9999;
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.2s';
                document.body.appendChild(toast);
            }
            toast.textContent = message;
            toast.style.opacity = '1';
            // ·∫®n sau 1.5s
            clearTimeout(toast._hideTimeout);
            toast._hideTimeout = setTimeout(() => {
                toast.style.opacity = '0';
            }, 1500);
        }

        // Sau khi x·ª≠ l√Ω DOMContentLoaded, n·∫øu l√† web con th√¨ ƒë·∫©y icon √¢m thanh l√™n v·ªã tr√≠ icon c√†i ƒë·∫∑t
        window.addEventListener('DOMContentLoaded', () => {
            const hash = window.location.hash;

            // Th√™m class v√†o body ƒë·ªÉ CSS c√≥ th·ªÉ detect
            if (hash.startsWith('#config=') || hash.startsWith('#id=')) {
                document.body.classList.add('web-con');
            } else {
                document.body.classList.add('web-cha');
            }

            // Ch·ªâ t·∫°o modal thanh to√°n khi ·ªü web cha (kh√¥ng c√≥ #config= ho·∫∑c #id=)
            if (!hash.startsWith('#config=') && !hash.startsWith('#id=')) {
                // Kh·ªüi t·∫°o modal thanh to√°n ch·ªâ cho web cha
                createPaymentModal();
            }

            // X·ª≠ l√Ω cho web con (c√≥ #config= ho·∫∑c #id=)
            if (hash.startsWith('#config=') || hash.startsWith('#id=')) {
                // ·∫®n n√∫t Google login tri·ªát ƒë·ªÉ
                const googleLoginBtn = document.getElementById('googleLoginBtn');
                if (googleLoginBtn) {
                    googleLoginBtn.style.display = 'none';
                    googleLoginBtn.classList.add('hidden');
                }
                // ·∫®n userLogoContainer tr√™n web con
                const userLogoContainer = document.getElementById('userLogoContainer');
                if (userLogoContainer) {
                    userLogoContainer.style.display = 'none';
                    userLogoContainer.classList.add('hidden');
                }
                // ƒê∆∞a n√∫t h∆∞·ªõng d·∫´n l√™n v·ªã tr√≠ g√≥c tr√™n tr√°i (thay v·ªã tr√≠ login)
                const helpIcon = document.querySelector('.help-icon');
                if (helpIcon) {
                    helpIcon.style.position = 'fixed';
                    helpIcon.style.top = '20px';
                    helpIcon.style.left = '20px';
                    helpIcon.style.right = '';
                    helpIcon.style.zIndex = 1003;
                    helpIcon.style.marginLeft = '0';
                }
            }

            // Hi·ªÉn th·ªã b·∫£ng h∆∞·ªõng d·∫´n ch√≠nh cho web cha (c·∫£ desktop v√† mobile)
            if (!hash.startsWith('#config=') && !hash.startsWith('#id=')) {
                setTimeout(() => {
                    showMainHelp();
                }, 1000); // ƒê·ª£i 1 gi√¢y ƒë·ªÉ trang load ho√†n to√†n
            }

            // Kh·ªüi t·∫°o WebSocket khi trang load
            initWebSocket();
        });

        // H√†m hi·ªÉn th·ªã b·∫£ng h∆∞·ªõng d·∫´n nhanh
        function showQuickHelp() {
            const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
            const mobileHelp = document.getElementById('mobileQuickHelp');
            const desktopHelp = document.getElementById('desktopQuickHelp');

            if (isMobile && mobileHelp) {
                mobileHelp.classList.add('active');
            } else if (!isMobile && desktopHelp) {
                desktopHelp.classList.add('active');
            }
        }

        // H√†m ƒë√≥ng b·∫£ng h∆∞·ªõng d·∫´n nhanh
        function closeQuickHelp(type) {
            const helpPanel = document.getElementById(type + 'QuickHelp');
            if (helpPanel) {
                helpPanel.classList.remove('active');
                // Ph√°t nh·∫°c khi ƒë√≥ng b·∫£ng h∆∞·ªõng d·∫´n
                if (window.audioManager) {
                    window.audioManager.playOnly();
                }
            }
        }

        // Th√™m v√†o global scope ƒë·ªÉ c√≥ th·ªÉ g·ªçi t·ª´ onclick
        window.closeQuickHelp = closeQuickHelp;

        // ƒê√≥ng b·∫£ng h∆∞·ªõng d·∫´n khi click b√™n ngo√†i
        document.addEventListener('click', (event) => {
            const mobileHelp = document.getElementById('mobileQuickHelp');
            const desktopHelp = document.getElementById('desktopQuickHelp');

            if (mobileHelp && mobileHelp.classList.contains('active') &&
                !mobileHelp.contains(event.target) &&
                !event.target.closest('.quick-help-close-btn')) {
                mobileHelp.classList.remove('active');
                // Ph√°t nh·∫°c khi ƒë√≥ng b·∫£ng h∆∞·ªõng d·∫´n
                if (window.audioManager) {
                    window.audioManager.playOnly();
                }
            }

            if (desktopHelp && desktopHelp.classList.contains('active') &&
                !desktopHelp.contains(event.target) &&
                !event.target.closest('.quick-help-close-btn')) {
                desktopHelp.classList.remove('active');
                // Ph√°t nh·∫°c khi ƒë√≥ng b·∫£ng h∆∞·ªõng d·∫´n
                if (window.audioManager) {
                    window.audioManager.playOnly();
                }
            }
        });

        // H√†m hi·ªÉn th·ªã b·∫£ng h∆∞·ªõng d·∫´n ch√≠nh cho web cha
        function showMainHelp() {
            const helpPanel = document.querySelector('.help-panel');
            if (helpPanel) {
                // L·∫ßn ƒë·∫ßu m·ªü - hi·ªÉn th·ªã ·ªü gi·ªØa m√†n h√¨nh
                helpPanel.classList.add('center');
                helpPanel.classList.add('active');
            }
        }
    </script>
    <script type="module" src="./js/auth.js"></script>
    <script type="module" src="./js/sphere.js"></script>
    <div id="flower-loading-overlay"
        style="display:block;position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.9);backdrop-filter:blur(12px);z-index:999999;pointer-events:none;">
        <div
            style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#fff;font-family:Arial,sans-serif;z-index:1;">
            <!-- Logo/Icon -->
            <div style="margin-bottom:30px;">
                <img src="assets/images/planet.png" alt="Love Planet"
                    style="width:60px;height:60px;filter:drop-shadow(0 0 10px rgba(255,107,107,0.5));animation:pulse 2s ease-in-out infinite;image-rendering: -webkit-optimize-contrast;image-rendering: crisp-edges;">
            </div>
            <!-- Spinner -->
            <div
                style="width:60px;height:60px;border:4px solid rgba(255,255,255,0.2);border-top:4px solid #ff6b6b;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 25px;box-shadow:0 0 30px rgba(255,107,107,0.6);">
            </div>
            <!-- Text -->
            <div
                style="font-size:24px;font-weight:700;margin-bottom:15px;text-shadow:0 0 15px rgba(255,255,255,0.6);background:linear-gradient(45deg, #ff6b6b, #ffd93d);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">
                Love Planet
            </div>
            <div style="font-size:18px;font-weight:500;margin-bottom:10px;text-shadow:0 0 10px rgba(255,255,255,0.5);">
                ƒêang t·∫£i thi√™n h√†...</div>
            <div style="font-size:14px;color:rgba(255,255,255,0.7);text-shadow:0 0 5px rgba(255,255,255,0.3);">Vui l√≤ng
                ch·ªù trong gi√¢y l√°t</div>
        </div>
    </div>
    <audio id="bg-audio" style="display:none"></audio>
    <canvas id="canvas"
        style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:10;pointer-events:none;"></canvas>
    <script src="./js/meteors.js"></script>
    <script>
        // Event listener cho user profile ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω trong auth.js
        // Kh√¥ng c·∫ßn duplicate ·ªü ƒë√¢y n·ªØa
    </script>
    <!-- Toast nh·ªè th√¥ng b√°o hi·ªáu ·ª©ng bay ·∫£nh -->
    <div id="flower-toast"
        style="position:fixed;bottom:32px;left:50%;right:auto;transform:translateX(-50%);background:rgba(30,30,30,0.92);color:#fff;font-size:13px;padding:7px 18px;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.12);z-index:9999;opacity:0;transition:opacity 0.2s;">
    </div>
</body>